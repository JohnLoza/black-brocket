// set delivery time label
$("#delivery-time").text("( <%= @parcel.delivery_time %> )");

// set prices and max weight
var parcel_weight_limitations = new Array();
var parcel_prices = new Array();

<% @prices.each do |price| %>
  parcel_prices.push(<%= price.price %>);
  parcel_weight_limitations.push(<%= price.max_weight %>);
<% end %>

wholesale = parseFloat($("#wholesale").text());
prev_sub_total = $("#order-sub-total").text().replace(",","");
prev_sub_total = parseFloat(prev_sub_total);

guides = getGuides(<%= session[:e_cart]["total_weight"] %>, parcel_weight_limitations, parcel_prices);
delivery_cost = calculateDeliveryCost(guides);

// calculate total including shipping cost
if(prev_sub_total >= wholesale){
  delivery_cost = 0.0;
  $("#shipping_cost_is_present").text("NO");
  console.log("BIG SALE! skipping shipping_cost");
}else{
  $("#shipping_cost_is_present").text("YES");
}

$("#order-shipping-cost").text(money_format(delivery_cost.toString()));

// replace total
new_sub_total = prev_sub_total + delivery_cost;
$("#order-grand-total").text(money_format(new_sub_total.toString()));

$("#delivery_cost").val(delivery_cost);
$("#guides").val(guidesToString(guides));

console.log(`cart weight: <%= session[:e_cart]["total_weight"]/1000 %>Kgs`);
console.log(`guides: ${$("#guides").val()}`);
