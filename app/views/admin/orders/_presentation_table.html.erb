<div class="col-lg-12">
  <div class="ibox">
    <div class="ibox-content">

      <%= render "navigation_labels" %>

      <table class="footable table table-stripped toggle-arrow-tiny" data-filter=#filter>
        <thead>
          <tr>
            <th>Folio</th>
            <!--<th data-hide="all">Cliente</th>
            <th data-hide="all">Teléfono del Cliente</th>
            <th data-hide="all">Correo del Cliente</th>-->
            <th data-hide="all">Correo electrónico</th>
            <th data-hide="all">Ubicación</th>
            <th data-hide="phone">Cliente</th>
            <th data-hide="all">Teléfono</th>
            <th data-type="numeric">Total a pagar</th>
            <th data-hide="phone,tablet">Distribuidor</th>
            <th>Status</th>
            <th data-hide="all"></th>
            <th data-hide="phone,tablet">Fecha de creación</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <% @orders.each do |o| %>
            <tr id="<%=o.hash_id%>">
              <td><%=o.hash_id%></td>
              <td><%= o.Client.email %></td>
              <% o_city = o.City %>
              <td><%= o_city.name %>, <%= o_city.State.name %></td>
              <td><%= o.Client.username %></td>
              <td><%= o.Client.telephone %></td>
              <td>$ <%= o.total %></td>
              <td>
                <% if o.distributor_id != 0 %>
                  <%= link_to o.Distributor.username, admin_distributor_path(o.Distributor.hash_id) %>
                <% else %>
                  <strong> Sin distribuidor en la zona </strong>
                <% end # if o.distributor_id != 0 # %>
              </td>
              <td>
                <span class="<%=@label_styles[o.state]%>">
                  <%=t(o.state)%>
                </span>
              </td>
              <td>
                <%= render partial: "hidden_row", locals: {o: o} %>
              </td>
              <td><%= l(o.created_at, format: :long) %></td>
              <td>
                <%= render partial: "order_actions", locals: {o: o} %>
              </td>
            </tr>
          <% end %>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="7">
              <div class="pull-right">
                <% if @orders != Array.new %>
                  <%= will_paginate @orders, renderer: BootstrapPagination::Rails %>
                <% end %>
              </div>
            </td>
          </tr>
        </tfoot>
      </table>

      <script>
          $(document).ready(function() {
              $('.footable').footable();
          });
      </script>

    </div>
  </div>
</div>

<%= render "shared/modal" %>

<script type="text/javascript">
  function update_cancel_form(target){
    $("#cancel_modal").modal("show");

    new_action = "<%= admin_cancel_order_path(0) %>";
    new_action = new_action.replace("0", target);

    $("#cancel_form").attr("action", new_action);
  }

  function update_reject_pay_form(target){
    $("#reject_modal").modal("show");

    new_action = "<%= admin_accept_order_pay_path(0,'false') %>";
    new_action = new_action.replace("0", target);

    $("#reject_pay_form").attr("action", new_action);
  }
</script>

<!-- Modal -->
<div class="modal inmodal in" id="cancel_modal" tabindex="-1"
     role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Cancelar orden/pedido</h4>
      </div>
      <div class="modal-body">
        <%= form_for :order, url: admin_cancel_order_path(0), method: :delete, html: {id: "cancel_form"} do |f| %>
          <%= f.label :cancel_description, "Descripción del por qué se cancela esta orden/pedido" %>
          <%= f.text_area :cancel_description, class: "form-control m-b", placeholder: "Escribe la razón de la cancelación...", required: true %>
          <%= f.submit "Cancelar la orden", class: "btn btn-danger btn-sm", data:{confirm: "¿Seguro(a) de cancelar la orden?"} %>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-greenbeauty"
                data-dismiss="modal"> Cerrar </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Modal -->
<div class="modal inmodal in" id="reject_modal" tabindex="-1"
     role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Rechazar pago de orden/pedido</h4>
      </div>
      <div class="modal-body">
        <%= form_for :order, url: admin_accept_order_pay_path(0,"false"),
              method: :put, html: {id: "reject_pay_form"} do |f| %>
          <%= f.label :reject_description, "Descripción del por qué se rechaza el pago de esta orden/pedido" %>
          <%= f.text_area :reject_description, class: "form-control m-b-sm", required: true %>
          <%= f.submit "Rechazar pago", class: "btn btn-danger btn-sm", data:{confirm: "Seguro(a) de rechazar el pago?"} %>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-greenbeauty"
                data-dismiss="modal"> Cerrar </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
