<div class="col-lg-12">
  <div class="ibox">
    <div class="ibox-content">

      <div class="row m-b-sm m-t-sm">
        <div class="col-md-10">
          <input type="text" class="form-control input-sm m-b-xs" id="filter" maxlength="20" placeholder="Buscar en tabla">
        </div>
        <div class="col-md-2">
          <%= link_to(admin_orders_path, :class => "btn btn-white btn-sm full-width") do %>
            <i class="fa fa-refresh"></i> Actualizar
          <% end %>
        </div>
      </div>

      <%= render "navigation_labels" %>

      <table class="footable table table-stripped toggle-arrow-tiny" data-filter=#filter>
        <thead>
          <tr>
            <th>Folio</th>
            <!--<th data-hide="all">Cliente</th>
            <th data-hide="all">Teléfono del Cliente</th>
            <th data-hide="all">Correo del Cliente</th>-->
            <th data-hide="all">Correo electrónico</th>
            <th data-hide="all">Ubicación</th>
            <th data-hide="phone">Cliente</th>
            <th data-hide="all">Teléfono</th>
            <th data-type="numeric">Total a pagar</th>
            <th data-hide="phone,tablet">Distribuidor</th>
            <th>Status</th>
            <th data-hide="all"></th>
            <th data-hide="phone,tablet">Fecha de creación</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <% @orders.each do |o| %>
            <tr id="<%=o.hash_id%>">
              <td><%=o.hash_id%></td>
              <td><%= o.Client.email %></td>
              <% o_city = o.City %>
              <td><%= o_city.name %>, <%= o_city.State.name %></td>
              <td><%= o.Client.username %></td>
              <td><%= o.Client.telephone %></td>
              <td>$ <%= o.total %></td>
              <td>
                <% if o.distributor_id != 0 %>
                  <%= link_to o.Distributor.username, admin_distributor_path(o.Distributor.hash_id) %>
                <% else %>
                  <strong> Sin distribuidor en la zona </strong>
                <% end # if o.distributor_id != 0 # %>
              </td>
              <td>
                <span class="<%=@label_styles[o.state]%>">
                  <%=t(o.state)%>
                </span>
              </td>
              <td>
                <%= render partial: "hidden_row", locals: {o: o} %>
              </td>
              <td><%= l(o.created_at, format: :long) %></td>
              <td>
                <%= render partial: "order_actions", locals: {o: o} %>
              </td>
            </tr>
          <% end %>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="7">
              <div class="pull-right">
                <% if @orders != Array.new %>
                  <%= will_paginate @orders, renderer: BootstrapPagination::Rails %>
                <% end %>
              </div>
            </td>
          </tr>
        </tfoot>
      </table>

      <script>
          $(document).ready(function() {
              $('.footable').footable();
          });
      </script>

    </div>
  </div>
</div>

<%= render "shared/modal" %>

<script type="text/javascript">
  function update_cancel_form(target){
    boot_modal = $("#modal");
    title = boot_modal.find(".modal-title");
    title.html("Cancelar orden/pedido");

    body = boot_modal.find(".modal-body");
    body.html("<%= j render 'cancel_order_form' %>");

    boot_modal.modal("show");

    new_action = "<%= admin_cancel_order_path(0) %>";
    new_action = new_action.replace("0", target);

    $("#cancel_form").attr("action", new_action);
  }

  function update_reject_pay_form(target){
    boot_modal = $("#modal");
    title = boot_modal.find(".modal-title");
    title.html("Rechazar pago de orden/pedido");

    body = boot_modal.find(".modal-body");
    body.html("<%= j render 'reject_order_pay_form' %>");

    boot_modal.modal("show");

    new_action = "<%= admin_accept_order_pay_path(0,'false') %>";
    new_action = new_action.replace("0", target);

    $("#reject_pay_form").attr("action", new_action);
  }
</script>
