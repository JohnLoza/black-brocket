<% provide(:title, "Productos") %>

<div class="row">
  <div class="col-md-12">
    <center>
      <h3 class="module-title long-up-2x">Nuestros Productos</h3>
      <h3 class="module-subtitle">El mejor café</h3>
    </center>
    <br><br>
  </div>
</div>
<!-- categories -->
<div class="row">
  <div class="col-md-3">

    <% if logged_in?%>
      <center>
       <%= image_tag @current_user.avatar_url(:mini), class: "img-rounded", :style => "width:130px;" %><br>
       <h5 style="margin-top: 10px;margin-bottom: 15px;"><%= @current_user.username %></h5>
      </center>
    <% end %>

    <%= form_tag(products_path, method: :get) do %>
      <div class="input-group">
        <%= text_field_tag :search, params[:search],
            {class: "input form-control", maxlength: 20, placeholder: "Buscar producto..."} %>

        <span class="input-group-btn">
          <%= submit_tag :Buscar, {class: "btn btn-custom-3 search-button"} %>
        </span>
      </div>
    <% end %>
    <br>

    <div class="iconbox js-hovered" style="margin-bottom: 15px;">
  		<div class="iconbox-body equal-height" style="padding:0px;">
  			<div class="iconbox-text">
  				<h3 class="iconbox-title" style="margin-top: 15px;">Categorías</h3>
  				<div class="iconbox-desc">
            <div class="list-group" style="margin: 0px;">
              <%= link_to "Todos", products_path, class: "list-group-item" %>
              <%= link_to "Frío", products_path + "?category=cold" , class: "list-group-item cold" %>
              <%= link_to "Caliente", products_path + "?category=hot" , class: "list-group-item hot" %>
              <%= link_to "Frappé", products_path + "?category=frappe" , class: "list-group-item frappe" %>
            </div>
  				</div>
  			</div>
  		</div>
  	</div>
  </div>
  <!-- end of categories -->

  <div class="col-md-9">
    <!-- products view -->
    <div class="row">
      <% if logged_in? and session[:user_type] == 'c' %>
        <%= render "product_grid_client" %>
      <% else %>
        <%= render "product_grid_visiter" %>
      <% end %>

      <div class="col-md-9 pull-right text-right">
        <%= will_paginate @products, renderer: BootstrapPagination::Rails %>
      </div>
    </div>
    <!-- end of products view -->
  </div>
</div>
<div class="row">
		<div class="col-sm-6 col-sm-offset-3">
      <div class="devider m-b-xxl">
        <%= image_tag("divider-down.svg") %>
      </div>
		</div>
</div>

<script type="text/javascript">
  function money_format(number){
    return parseFloat(number).toFixed(2).replace(/./g, function(c, i, a) {
      return i && c !== "." && ((a.length - i) % 3 === 0) ? ',' + c : c;
    });
  }

  $(document).ready(function(){
    numbers_to_format = $(".money_format");
    numbers_to_format.each(function(){
      $(this).html(money_format($(this).text()));
    });
  });

  <% if params[:category] and params[:category] == "hot" or params[:category] == "cold" or params[:category] == "frappe" %>
    $(document).ready(function(){
      $(".<%=params[:category]%>").addClass("active");
    });
  <% end %>
</script>

<% if !@visit.nil? %>
<!-- Modal -->
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="padding: .5em;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Visita del distribuidor</h4>
      </div>
      <%= form_for(@visit, url: client_update_distributor_visit_path(@visit.id), method: :put) do |f| %>
        <% distributor = @visit.Distributor %>
        <br>
        <div class="row">
          <div class="col-sm-12">
             <div class="col-sm-3">
               <center>
                 <%= image_tag User.avatar_url(distributor, :mini),class: "img-circle" %>
               </center>
             </div>
             <div class="col-sm-9">
               <label>Distribuidor:</label><br>
               <%= distributor.name %> <%= distributor.lastname %>
             </div>
          </div>
        </div>
        <br>

        <div class="col-sm-12">
          <p>En garantía de nuestro servicio y en atención a su persona,
          el distribuidor <b><%= distributor.name %> <%= distributor.lastname %></b> ¿Pasó a visitarle el día <%= l(@visit.visit_date, format: :long) %>?
          <select name="distributor_visit[client_recognizes_visit]"
                  id="distributor_visit_client_recognizes_visit" required="required"
                  onchange="update_visit_form(this);">
                  <option value="">Selecciona...</option>
                  <option value="true">Sí</option>
                  <option value="false">No</option>
          </select></p>

          <p>Si la respuesta es sí llene el resto del formulario,
          de lo contrario presione "guardar" al final del formulario.</p>

          <p>Su trato fue:
          <select name="distributor_visit[treatment_answer]"
                  id="distributor_visit_treatment_answer" required="required">
                  <option value="">Selecciona...</option>
                  <option value="Excelente">Excelente</option>
                  <option value="Bueno">Bueno</option>
                  <option value="Regular">Regular</option>
                  <option value="Malo">Malo</option>
          </select></p>

          <p><b>Sugerencias y/o comentarios:</b></p>
          <%= f.text_area :extra_comments, class: "input form-control", style: "border: solid #999 1px;" %><br>
        </div>
        <div class="clearfix"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-white" data-dismiss="modal">Cerrar</button>
          <%= submit_tag "Guardar", class: "btn btn-primary" %>
        </div>

      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function(){
    $("#modal").modal("show");
  });

  function update_visit_form(visit_selector){
    field = $("#distributor_visit_treatment_answer");
    if (visit_selector.value == "false"){
      field.prop("disabled", true);
      field.attr("required", false);
    }else{
      field.prop("disabled", false);
      field.attr("required", true);
    }
  }
</script>
<% end # if @visit # %>
